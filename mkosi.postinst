#!/bin/sh -e

# .postinst has no network and root password is set.

UID=1000
GID='users'
USER='user'
HOME="/home/$USER"

useradd \
    --uid "$UID" \
    --gid "$GID" \
    --groups sudo \
    --create-home \
    --home-dir "$HOME" \
    --password "$( awk -F: '/^root:/ {print $2}' /etc/shadow )" \
    --shell /bin/bash \
    "$USER"

if [ -f /root/.ssh/authorized_keys ]
then
    mkdir "$HOME/.ssh"
    cp /root/.ssh/authorized_keys "$HOME/.ssh/"
fi

chown -R "$UID:$GID" "$HOME"
